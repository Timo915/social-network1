<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - <%= user.username %></title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #e9ecef;
            color: #343a40;
        }
        h1, h2 {
            color: #0056b3;
            text-align: center;
        }
        nav {
            background-color: #007bff;
            padding: 15px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        nav a {
            color: white;
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 5px;
            margin: 5px;
            transition: background-color 0.3s;
        }
        nav a:hover {
            background-color: #0056b3;
        }
        .content {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .user-info img {
            border-radius: 50%;
            margin-right: 20px;
            max-width: 100px;
        }
        .user-actions {
            display: flex;
            flex-direction: column;
            margin-left: auto;
        }
        .user-actions button {
            margin-top: 5px;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .user-actions button:hover {
            background-color: #0056b3;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        .post-card {
            background: white;
            margin: 10px auto;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .post-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .post-actions button {
            padding: 5px 10px;
            font-size: 14px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .post-actions button:hover {
            background-color: #0056b3;
        }
        video, img {
            max-width: 100%;
            border-radius: 5px;
            margin: 10px 0;
        }
        footer {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            color: #777;
            background-color: #f1f1f1;
            border-top: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <h1>–ü—Ä–æ—Ñ–∏–ª—å - <%= user.username %></h1>
    
    <nav>
        <a href="/logout">–í—ã–π—Ç–∏</a>
        <a href="/home">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/create-post">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</a>
        <a href="/music">–ú—É–∑—ã–∫–∞</a>
        <a href="/calls">–ó–≤–æ–Ω–∫–∏</a>
        <a href="/history">–ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π</a>
        <a href="/friends">–°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π</a>
        <a href="/profile/<%= currentUser ? currentUser._id : '' %>">–ü—Ä–æ—Ñ–∏–ª—å</a>
    </nav>

    <div class="content">
        <div class="user-info">
            <img src="<%= user.profilePicture %>" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è">
            <div>
                <h2><%= user.name %></h2>
                <p><strong>Email:</strong> <%= user.email %></p>
                <div class="user-actions">
                    <button id="addFriendBtn" onclick="addFriend('<%= user._id %>')">–î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑—å—è</button>
                    <button onclick="window.location.href='/messages/<%= user._id %>'">–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                </div>
            </div>
        </div>

        <h2>–ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</h2>
        <ul>
            <% if (posts && posts.length > 0) { %>
                <% posts.forEach(post => { %>
                    <li class="post-card">
                        <p><strong><%= post.content %></strong></p>
                        <% if (post.imageUrl) { %>
                            <img src="<%= post.imageUrl %>" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞">
                        <% } %>
                        <% if (post.videoUrl) { %>
                            <video controls>
                                <source src="<%= post.videoUrl %>" type="video/mp4">
                                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                            </video>
                        <% } %>
                        <p>–°–æ–∑–¥–∞–Ω: <%= new Date(post.createdAt).toLocaleString() %></p>
                        <div class="post-actions">
                            <button onclick="likePost('<%= post._id %>')">üëç –õ–∞–π–∫</button>
                            <button onclick="sharePost('<%= post._id %>')">üîó –ü–µ—Ä–µ—Å–ª–∞—Ç—å</button>
                            <button onclick="commentPost('<%= post._id %>')">üí¨ –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                    </li>
                <% }) %>
            <% } else { %>
                <li>–ù–µ—Ç –ø–æ—Å—Ç–æ–≤ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</li>
            <% } %>
        </ul>
    </div>

    <footer>
        <p>&copy; 2023 –í–∞—à –†–µ—Å—É—Ä—Å</p>
    </footer>

    <script>
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥—Ä—É–∂–±—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            const userId = '<%= user._id %>';
            const button = document.getElementById('addFriendBtn');

            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –¥—Ä—É–∂–±—ã
            fetch(`/api/friend-status/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'friend') {
                        button.textContent = '–£ –≤–∞—Å –≤ –¥—Ä—É–∑—å—è—Ö';
                        button.disabled = true; // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π
                    } else if (data.status === 'pending') {
                        button.textContent = '–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω';
                        button.disabled = true; // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π
                    }
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –¥—Ä—É–∂–±—ã:', error));
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –¥—Ä—É–∑—å—è
        function addFriend(userId) {
            fetch(`/api/send-friend-request`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ friendId: userId }) // –ü–µ—Ä–µ–¥–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞
            })
            .then(response => {
                if (response.ok) {
                    return response.json(); // –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –≤ JSON
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –¥—Ä—É–∑—å—è.'); // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                }
            })
            .then(data => {
                alert(data.message); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                document.getElementById('addFriendBtn').textContent = '–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω'; // –ò–∑–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ
                document.getElementById('addFriendBtn').disabled = true; // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert(error.message); // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–∞–π–∫–∞ –ø–æ—Å—Ç–∞
        function likePost(postId) {
            fetch(`/api/like-post/${postId}`, { method: 'POST' })
                .then(response => {
                    if (response.ok) {
                        alert('–ü–æ—Å—Ç –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è!');
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ª–∞–π–∫–µ –ø–æ—Å—Ç–∞.');
                    }
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –ø–æ—Å—Ç–∞
        function sharePost(postId) {
            alert(`–ü–æ—Å—Ç ${postId} –ø–µ—Ä–µ—Å–ª–∞–Ω!`); // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –ø–æ—Å—Ç–∞
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –ø–æ—Å—Ç—É
        function commentPost(postId) {
            const comment = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:");
            if (comment) {
                fetch(`/api/comments/${postId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content: comment }) // –ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
                })
                .then(response => {
                    if (response.ok) {
                        alert('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω!');
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è.');
                    }
                });
            }
        }
    </script>
</body>
</html>